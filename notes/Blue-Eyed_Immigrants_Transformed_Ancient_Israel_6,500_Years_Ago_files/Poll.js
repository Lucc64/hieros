define("Purch/UI/Poll",["jquery"],function(a){"use strict";var b=function(b){this.conf=a.extend({id:null,slug:null,element:null},b||{}),!1!==this.conf.init&&this.init()};return b.prototype={init:function(){var b=this;if(b.totalVotes=0,null!=b.checkCookie(pollName)){if(-1!==b.checkCookie(pollName).split(",").indexOf(b.conf.id))return void b.getResults();a(b.conf.element).find(".loading").hide()}else a(b.conf.element).find(".loading").hide();a(b.conf.element).find(".option").on("click touchstart",function(c){a(b.conf.element).find(".loading").show(),b.sendOption(a(this).data("poll-option-id"))}),a(b.conf.element).find(".get-results").on("click touchstart",function(c){a(b.conf.element).find(".loading").show(),b.getResults("")})},checkCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null},setCookie:function(){var a=this;null!==a.checkCookie(pollName)?document.cookie=pollName+"="+a.checkCookie(pollName)+","+a.conf.id+";":document.cookie=pollName+"="+a.conf.id+";"},sendOption:function(b){var c=this;a.ajax({type:"POST",url:"/pollvotes",data:'data={"poll_id":'+c.conf.id+', "option_id":'+b+', "slug" : "'+c.conf.slug+'"}',dataType:"json",success:function(a){c.showResults(a,"Thanks for voting!"),c.setCookie()}})},getResults:function(b){var c=this;b=void 0!==b?b:"You already voted!",a.ajax({type:"GET",url:"/pollvotes/"+c.conf.slug,dataType:"json",success:function(a){c.showResults(a,b)}})},showResults:function(b,c){var d=this;if(a(d.conf.element).addClass("poll-results"),"success"==b.status){for(var e in b.poll_vote_totals)d.totalVotes+=b.poll_vote_totals[e];for(var e in b.poll_vote_totals){var f=Math.round(b.poll_vote_totals[e]/d.totalVotes*100),g=b.poll_vote_totals[e]>1?"votes":"vote";a('[data-poll-option-id="'+e+'"] .option-votes').html("("+b.poll_vote_totals[e]+" "+g+")"),a('[data-poll-option-id="'+e+'"] .option-percent').html(f+"%"),a('[data-poll-option-id="'+e+'"] .option-bar .option-fill').css("width",f+"%")}a(d.conf.element).find(".total-votes").html("Total Votes: "+d.totalVotes),a(".poll-message").html(c),a(d.conf.element).find(".get-results").hide(),a(d.conf.element).find(".loading").hide()}}},b});